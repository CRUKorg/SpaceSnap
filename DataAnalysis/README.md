This code is very much hacked together.
If you consider using this, reconsider.
If you still really want to use it and can't work out what on earth is going on, my email is jcr111@doc.ic.ac.uk
